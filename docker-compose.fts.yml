# Full-text search addon: Apache Tika + Meilisearch
#
# Usage:
#   Community:
#     docker compose -f docker-compose.yml -f docker-compose.fts.yml up -d
#   Pro:
#     docker compose -f docker-compose.yml -f docker-compose.pro.yml -f docker-compose.fts.yml up -d
#
# Set MEILI_MASTER_KEY in .env or export it as an environment variable.
# Generate one with: openssl rand -hex 32

services:
  cloudreve:
    environment:
      - CR_SETTING_DEFAULT_fts_meilisearch_api_key=${MEILI_MASTER_KEY}
      - CR_SETTING_DEFAULT_fts_meilisearch_endpoint=http://meilisearch:7700
      - CR_SETTING_DEFAULT_fts_enabled=1
      - CR_SETTING_DEFAULT_fts_tika_endpoint=http://tika:9998

    depends_on:
      tika:
        condition: service_started
      meilisearch:
        condition: service_started

  tika:
    image: apache/tika:latest
    container_name: tika
    restart: unless-stopped

  meilisearch:
    image: getmeili/meilisearch:latest
    container_name: meilisearch
    restart: unless-stopped
    environment:
      - MEILI_MASTER_KEY=${MEILI_MASTER_KEY}
    volumes:
      - meili_data:/meili_data

volumes:
  meili_data:
